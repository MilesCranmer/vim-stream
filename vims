#!/bin/bash
# The argument fixes were supplied by John Kugelman
# https://stackoverflow.com/a/44745698/2689923
vim_cmds=()

PRINT_ALL=1
DISABLE_VIMRC=0

while (($# > 0)); do
    arg="$1"
    case "$arg" in
        -n|--silent|--quiet)
            PRINT_ALL=0
            ;;
        -d|--disable-vimrc)
            DISABLE_VIMRC=1
            ;;
        *)
            # unknown option
            vim_cmds+=(-c "$1")
            ;;
    esac
    shift
done

# Headless vim which exits after printing all lines
# Taken from Csaba Hoch:
# https://groups.google.com/forum/#!msg/vim_use/NfqbCdUkDb4/Ir0faiNaFZwJ
if [ "$PRINT_ALL" -eq "1" ]; then
    vim_cmds+=(-c ":%p")
fi
if [ "$DISABLE_VIMRC" -eq "1" ]; then
    vim_cmds=(-u NONE "${vim_cmds[@]}")
fi

vim - -nes "${vim_cmds[@]}" -c ':q!' | tail -n +2
